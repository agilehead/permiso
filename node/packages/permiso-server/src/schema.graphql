scalar JSON

# Core Types
type Tenant {
  id: ID!
  name: String!
  description: String
  properties: [Property!]!
  createdAt: Float!
  updatedAt: Float!
  
  # Relationships
  users(filter: UserFilter, pagination: PaginationInput): UserConnection!
  roles(filter: RoleFilter, pagination: PaginationInput): RoleConnection!
  resources(filter: ResourceFilter, pagination: PaginationInput): ResourceConnection!
}

type User {
  id: ID!
  tenantId: ID!
  identityProvider: String!
  identityProviderUserId: String!
  properties: [Property!]!
  createdAt: Float!
  updatedAt: Float!
  
  # Relationships
  tenant: Tenant!
  roles: [Role!]!
  permissions: [UserPermission!]!
  effectivePermissions(resourceId: String, action: String): [EffectivePermission!]!
}

type Role {
  id: ID!
  tenantId: ID!
  name: String!
  description: String
  properties: [Property!]!
  createdAt: Float!
  updatedAt: Float!
  
  # Relationships
  tenant: Tenant!
  users: [User!]!
  permissions: [RolePermission!]!
}

type Resource {
  id: ID!  # This is the path (e.g., /india/data/legal)
  tenantId: ID!
  name: String
  description: String
  createdAt: Float!
  updatedAt: Float!
  
  # Relationships
  tenant: Tenant!
  permissions: [Permission!]!
}

type Property {
  name: String!
  value: JSON
  hidden: Boolean!
  createdAt: Float!
}

interface Permission {
  resourceId: ID!
  action: String!
  createdAt: Float!
  tenant: Tenant!
  resource: Resource!
}

type UserPermission implements Permission {
  userId: ID!
  resourceId: ID!
  action: String!
  createdAt: Float!
  tenant: Tenant!
  resource: Resource!
  user: User!
}

type RolePermission implements Permission {
  roleId: ID!
  resourceId: ID!
  action: String!
  createdAt: Float!
  tenant: Tenant!
  resource: Resource!
  role: Role!
}

type EffectivePermission {
  resourceId: ID!
  action: String!
  source: String! # 'user' or 'role'
  sourceId: ID # userId or roleId
  createdAt: Float!
}

# Connection types for pagination
type TenantConnection {
  nodes: [Tenant!]!
  totalCount: Int!
  pageInfo: PageInfo!
}

type UserConnection {
  nodes: [User!]!
  totalCount: Int!
  pageInfo: PageInfo!
}

type RoleConnection {
  nodes: [Role!]!
  totalCount: Int!
  pageInfo: PageInfo!
}

type ResourceConnection {
  nodes: [Resource!]!
  totalCount: Int!
  pageInfo: PageInfo!
}

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

# Query type
type Query {
  # Tenants
  tenant(id: ID!): Tenant
  tenants(filter: TenantFilter, pagination: PaginationInput): TenantConnection!
  tenantsByIds(ids: [ID!]!): [Tenant!]!
  tenantProperty(tenantId: ID!, propertyName: String!): Property
  
  # Users (scoped to tenant via x-tenant-id header)
  user(userId: ID!): User
  users(filter: UserFilter, pagination: PaginationInput): UserConnection!
  usersByIds(ids: [ID!]!): [User!]!
  usersByIdentity(identityProvider: String!, identityProviderUserId: String!): [User!]!
  userProperty(userId: ID!, propertyName: String!): Property
  
  # Roles (scoped to tenant via x-tenant-id header)
  role(roleId: ID!): Role
  roles(filter: RoleFilter, pagination: PaginationInput): RoleConnection!
  rolesByIds(ids: [ID!]!): [Role!]!
  roleProperty(roleId: ID!, propertyName: String!): Property
  
  # Resources (scoped to tenant via x-tenant-id header)
  resource(resourceId: ID!): Resource
  resources(filter: ResourceFilter, pagination: PaginationInput): ResourceConnection!
  resourcesByIdPrefix(idPrefix: String!): [Resource!]!
  
  # Permissions (scoped to tenant via x-tenant-id header)
  userPermissions(userId: ID!, resourceId: String, action: String): [UserPermission!]!
  rolePermissions(roleId: ID!, resourceId: String, action: String): [RolePermission!]!
  effectivePermissions(userId: ID!, resourceId: String!, action: String): [EffectivePermission!]!
  effectivePermissionsByPrefix(
    userId: ID!, 
    resourceIdPrefix: String!, 
    action: String
  ): [EffectivePermission!]!
  
  # Check permission (returns boolean)
  hasPermission(userId: ID!, resourceId: String!, action: String!): Boolean!
}

# Mutation type
type Mutation {
  # Tenants
  createTenant(input: CreateTenantInput!): Tenant!
  updateTenant(id: ID!, input: UpdateTenantInput!): Tenant!
  deleteTenant(id: ID!, safetyKey: String): Boolean!
  
  # Tenant Properties
  setTenantProperty(tenantId: ID!, name: String!, value: JSON, hidden: Boolean): Property!
  deleteTenantProperty(tenantId: ID!, name: String!): Boolean!
  
  # Users (scoped to tenant via x-tenant-id header)
  createUser(input: CreateUserInput!): User!
  updateUser(userId: ID!, input: UpdateUserInput!): User!
  deleteUser(userId: ID!): Boolean!
  
  # User Properties
  setUserProperty(userId: ID!, name: String!, value: JSON, hidden: Boolean): Property!
  deleteUserProperty(userId: ID!, name: String!): Boolean!
  
  # User Roles
  assignUserRole(userId: ID!, roleId: ID!): User!
  unassignUserRole(userId: ID!, roleId: ID!): User!
  
  # Roles (scoped to tenant via x-tenant-id header)
  createRole(input: CreateRoleInput!): Role!
  updateRole(roleId: ID!, input: UpdateRoleInput!): Role!
  deleteRole(roleId: ID!): Boolean!
  
  # Role Properties
  setRoleProperty(roleId: ID!, name: String!, value: JSON, hidden: Boolean): Property!
  deleteRoleProperty(roleId: ID!, name: String!): Boolean!
  
  # Resources (scoped to tenant via x-tenant-id header)
  createResource(input: CreateResourceInput!): Resource!
  updateResource(resourceId: ID!, input: UpdateResourceInput!): Resource!
  deleteResource(resourceId: ID!): Boolean!
  
  # Permissions (scoped to tenant via x-tenant-id header)
  grantUserPermission(input: GrantUserPermissionInput!): UserPermission!
  revokeUserPermission(userId: ID!, resourceId: ID!, action: String!): Boolean!
  
  grantRolePermission(input: GrantRolePermissionInput!): RolePermission!
  revokeRolePermission(roleId: ID!, resourceId: ID!, action: String!): Boolean!
}

# Input types
input CreateTenantInput {
  id: ID!
  name: String!
  description: String
  properties: [PropertyInput!]
}

input UpdateTenantInput {
  name: String
  description: String
}

input CreateUserInput {
  id: ID!
  identityProvider: String!
  identityProviderUserId: String!
  properties: [PropertyInput!]
  roleIds: [ID!]
}

input UpdateUserInput {
  identityProvider: String
  identityProviderUserId: String
}

input CreateRoleInput {
  id: ID!
  name: String!
  description: String
  properties: [PropertyInput!]
}

input UpdateRoleInput {
  name: String
  description: String
}

input CreateResourceInput {
  id: ID!
  name: String
  description: String
}

input UpdateResourceInput {
  name: String
  description: String
}

input PropertyInput {
  name: String!
  value: JSON
  hidden: Boolean
}

input GrantUserPermissionInput {
  userId: ID!
  resourceId: ID!
  action: String!
}

input GrantRolePermissionInput {
  roleId: ID!
  resourceId: ID!
  action: String!
}

# Filter inputs
input TenantFilter {
  properties: [PropertyFilter!]
}

input UserFilter {
  properties: [PropertyFilter!]
  identityProvider: String
  identityProviderUserId: String
}

input RoleFilter {
  properties: [PropertyFilter!]
}

input ResourceFilter {
  idPrefix: String
}

input PropertyFilter {
  name: String!
  value: JSON
}

enum SortDirection {
  ASC
  DESC
}

input PaginationInput {
  offset: Int
  limit: Int
  sortDirection: SortDirection # Optional, defaults to ASC if not provided
}